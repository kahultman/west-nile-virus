---
title: "WNV Exploration"
author: "Keith Hultman"
date: "November 19, 2016"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
load("./data/trainset1.RData")


#trainset1$Week <- trainset1$Date$yday -
  
trainset1$Date <- as.POSIXlt(trainset1$Date)
trainset1$Year <- trainset1$Date$year+1900
trainset1$Week <- floor((trainset1$Date$yday - trainset1$Date$wday + 7) /7)

plot(trainset1$Week, trainset1$NumMosquitos)


library(tidyverse)

ts3 <- trainset1 %>% select(Week, NumMosquitos) %>%
  group_by(Week) %>%
  summarise(avg = mean(NumMosquitos)) 


ggplot(ts3, aes(x=Week, y=avg)) + geom_point() + geom_smooth() + ggtitle("Number of Mosquitos per week") + ylab("Average number of mosquitos per trap")

ggplot(trainset1, aes(x=Tmin, y=NumMosquitos)) + geom_point() + geom_smooth(method = lm)

ggplot(trainset1, aes(x=DewPoint, y=NumMosquitos)) + geom_point() + geom_smooth(method = lm)

ggplot(trainset1, aes(x=(Sunset - Sunrise), y=NumMosquitos)) + geom_point() + geom_smooth(method = lm)

ggplot(trainset1, aes(x=ma10, y=NumMosquitos)) + geom_point() + geom_smooth(method = lm)

ggplot(trainset1, aes(x=precip10d, y=NumMosquitos)) + geom_point() + geom_smooth(method = lm)

ggplot(trainset1, aes(x=Week, y=NumMosquitos)) + geom_point() + geom_smooth()

ggplot(trainset1, aes(x=(abs(32-Week)), y=NumMosquitos)) + geom_point() + geom_smooth(method = lm)

```


## Animated map!

```{r}
library(tidyverse)
library(gganimate)
library(animation)


load("./data/trainset2.RData")
byweek <- group_by(trainset2, Week) %>% summarize(weekly_avg_mosq=mean(NumMosquitos))

map_mosq <- ggplot(trainset2, aes(x=Longitude, y=Latitude, 
                                  size=NumMosquitos, 
                                  color=WnvPresent,
                                  frame=Week)) + geom_point() + ggtitle("Animated map of mosquitos and presence of West Nile Virus in Chicago")

animated_map_mosq <- gg_animate(map_mosq)

gg_animate_save(animated_map_mosq, filename = "Animated Mosquito Map.gif")
```

```{r}
library(tweenr)

traincomplete <- complete(trainset2, Longitude, Latitude, Week)

table(traincomplete$Trap[traincomplete$Week==21])
T054week21 <- filter(traincomplete, Trap == "T054", Week == 21)
View(T054week21)

#traincomplete <- traincomplete %>% group_by(Trap, Week) %>% summarise()

tw_mosq <- split(traincomplete, f = traincomplete$Week)
tw_mosq[[1]]
tw_mosq <- traincomplete %>% split(.$Week) %>%
  tweenr::tween_states(tweenlength = 5, statelength = 0, 
                       ease = "linear",
                       nframes = 175)
map_mosq <- ggplot(tw_mosq, aes(x=Longitude, y=Latitude, 
                                  size=NumMosquitos, 
                                  color=WnvPresent,
                                  frame=.frame)) + geom_point() + ggtitle("Animated map of mosquitos and presence of West Nile Virus in Chicago")

```

```{r}
library(ggmap)

chicago <- get_map("Chicago")

ani_map <- ggmap(chicago) + 
  geom_point(data = trainset2, aes(x=Longitude, y=Latitude, 
                                   size=NumMosquitos, 
                                   color=WnvPresent,
                                   frame=Week)) + 
  ggtitle("Animated map of mosquitos and presence of West Nile Virus in Chicago")

gg_animate(ani_map)

```














