---
title: "WNV Exploration"
author: "Keith Hultman"
date: "November 19, 2016"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
load("./data/trainset1.RData")


#trainset1$Week <- trainset1$Date$yday -
  
trainset1$Date <- as.POSIXlt(trainset1$Date)
trainset1$Year <- trainset1$Date$year+1900
trainset1$Week <- floor((trainset1$Date$yday - trainset1$Date$wday + 7) /7)

plot(trainset1$Week, trainset1$NumMosquitos)


library(tidyverse)

ts3 <- trainset1 %>% select(Week, NumMosquitos) %>%
  group_by(Week) %>%
  summarise(avg = mean(NumMosquitos)) 


ggplot(ts3, aes(x=Week, y=avg)) + geom_point() + geom_smooth() + ggtitle("Number of Mosquitos per week") + ylab("Average number of mosquitos per trap")

ggplot(trainset1, aes(x=Tmin, y=NumMosquitos)) + geom_point() + geom_smooth(method = lm)

ggplot(trainset1, aes(x=DewPoint, y=NumMosquitos)) + geom_point() + geom_smooth(method = lm)

ggplot(trainset1, aes(x=(Sunset - Sunrise), y=NumMosquitos)) + geom_point() + geom_smooth(method = lm)

ggplot(trainset1, aes(x=ma10, y=NumMosquitos)) + geom_point() + geom_smooth(method = lm)

ggplot(trainset1, aes(x=precip10d, y=NumMosquitos)) + geom_point() + geom_smooth(method = lm)

ggplot(trainset1, aes(x=Week, y=NumMosquitos)) + geom_point() + geom_smooth()

ggplot(trainset1, aes(x=(abs(32-Week)), y=NumMosquitos)) + geom_point() + geom_smooth(method = lm)

```


## Animated map!

```{r}
library(tidyverse)
library(gganimate)
library(animation)


load("./data/trainset2.RData")
byweek <- group_by(trainset2, Week) %>% summarize(weekly_avg_mosq=mean(NumMosquitos))

map_mosq <- ggplot(trainset2, aes(x=Longitude, y=Latitude, 
                                  size=NumMosquitos, 
                                  color=WnvPresent,
                                  frame=Week)) + geom_point() + ggtitle("Animated map of mosquitos and presence of West Nile Virus in Chicago")

animated_map_mosq <- gg_animate(map_mosq)

gg_animate_save(animated_map_mosq, filename = "Animated Mosquito Map.gif")
```

```{r}
library(tweenr)

traincomplete <- complete(trainset2, Trap, nesting(Longitude, Latitude), Week)

traincomplete <- trainset2 %>% group_by(Longitude, Latitude, Week) %>% summarise(NumMosSum = sum(NumMosquitos), WnvSum = any(WnvPresent))



traincomplete <- ungroup(traincomplete)

traincomplete$Week <- as.factor(traincomplete$Week)
traincomplete2 <- complete(traincomplete, Week, Longitude, Latitude, fill = list(NumMosSum = 0, WnvSum = FALSE))


table(traincomplete2$Week)
?split
tw_mosq <- split(traincomplete2, f = traincomplete2$Week)
tw_mosq[[2]]


tw_mosq2 <- tween_states(tw_mosq, tweenlength = 3, 
                       statelength = 1, 
                       ease = "linear",
                       nframes = 100)

map_mosq <- ggplot(tw_mosq2, aes(x=Longitude, y=Latitude, 
                                  size=NumMosSum, 
                                  color=WnvSum,
                                  frame=.frame)) + geom_point() + ggtitle("Animated map of mosquitos and presence of West Nile Virus in Chicago")

save(map_mosq, file = "./data/map_mosq.RData")
load("./data/map_mosq.RData")
gg.map <- gg_animate(map_mosq)
gg_animate_save(gg.map, filename = "mosq.map.gif")
```

```{r}
library(ggmap)

chicago <- get_map("Chicago")

ani_map <- ggmap(chicago) + 
  geom_point(data = trainset2, aes(x=Longitude, y=Latitude, 
                                   size=NumMosquitos, 
                                   color=WnvPresent,
                                   frame=Week)) + 
  ggtitle("Animated map of mosquitos and presence of West Nile Virus in Chicago")

gg_ani_map <- gg_animate(ani_map)
gg_animate_save(gg_ani_map, filename = "Chicago Mosq animated map.gif")
```





```{r}
df <- data_frame(
  group = c(1:2, 1),
  item_id = c(1:2, 2),
  item_name = c("a", "b", "b"),
  value1 = 1:3,
  value2 = 4:6
)
df
df %>% complete(group, item_id, item_name)
df
```









